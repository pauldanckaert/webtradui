<html>
<head>
	<title>Tradui Demonstration</title>
	<script type="text/javascript" src="javascript/gears_init.js"></script>
 	<script type="text/javascript" src="javascript/jquery-1.4.min.js"></script>          
 	<script type="text/javascript" src="javascript/TiWrap.js"></script>          
 	<script type="text/javascript" src="javascript/libtradui.js"></script>          
</head>
<body>

<script>

// These functions are simply to show the use of the libtradui capabilites to update a web page
// with the information, allowing the user to traverse and view the database contents updated from
// the xml data.
//

function showLanguages() {
	var languages = Tradui.Database.Query.getLanguages();

	var htmlBlock = "<select id='language' name='language' onChange='return showCategories();'>";
	htmlBlock += "<option value=''>Select Language..</option>";
	for ( var i=0; i<languages.length; ++i ){
		htmlBlock += "<option>" + languages[i] + "</option>";
	}
	htmlBlock += "</select>";

	document.getElementById('languageList').innerHTML = htmlBlock;
	document.getElementById('categoryList').innerHTML = '';
	document.getElementById('phraseList').innerHTML = '';
	document.getElementById('phraseDetails').innerHTML = '';
}

function showCategories() {
	var language = document.getElementById('language').value;

	if (language!="") {
		var categories = Tradui.Database.Query.getCategories(language);

		var htmlBlock = "<select id='category' name='category' onChange='return showPhrases();'>";
		htmlBlock += "<option value=''>Select Category..</option>";
		for ( var i=0, len=categories.length; i<len; ++i ){
			htmlBlock += "<option value='" + 
				categories[i].categoryId + "'>" + 
				categories[i].title + " <i>(" + 
				categories[i].count + ")</i> </option>";
		}
		htmlBlock += "</select>";

		document.getElementById('categoryList').innerHTML = htmlBlock;
	} else {
		document.getElementById('categoryList').innerHTML = '';
	}
	document.getElementById('phraseList').innerHTML = '';
	document.getElementById('phraseDetails').innerHTML = '';
}

function showPhrases() {
	var language = document.getElementById('language').value;
	var category = document.getElementById('category').value;

	if (language!="" && category!="") {
		var phrases = Tradui.Database.Query.getPhrases(language, category);

		var htmlBlock = "<select id='phrase' name='phrase' onChange='return showPhraseDetails();'>";
		htmlBlock += "<option value=''>Select Phrase..</option>";
		for ( var i=0, len=phrases.length; i<len; ++i ){
			htmlBlock += "<option value='" + 
				phrases[i].phraseId + "'>" + 
				phrases[i].text + "</option>";
		}
		htmlBlock += "</select>";

		document.getElementById('phraseList').innerHTML = htmlBlock;
	} else {
		document.getElementById('phraseList').innerHTML = '';
	}
	document.getElementById('phraseDetails').innerHTML = '';
}

function showPhraseDetails() {
	var language = document.getElementById('language').value;
	var phrase = document.getElementById('phrase').value;

	if (language!="" && phrase!="") {
		var phraseDetails = Tradui.Database.Query.getPhraseDetails(language, phrase);

		var htmlBlock = "<ul>";
		for ( var i=0, len=phraseDetails.length; i<len; ++i ){
			htmlBlock += "<li>" + phraseDetails[i].text + " (" + phraseDetails[i].language + ") (" +
			phraseDetails[i].audioFile + ") </li>";
		}
		htmlBlock += "</ul>";

		document.getElementById('phraseDetails').innerHTML = htmlBlock;
	} else {
		document.getElementById('phraseDetails').innerHTML = '';
	}

}

function searchDictionaryCreole() {
	var searchWord = document.getElementById('searchWordCreole').value;
	var words = Tradui.Database.Query.searchDictionary(searchWord, 'Creole', 'English');

	var htmlBlock = "<ul>";
	for ( var i=0, len=words.length; i<len; ++i ){
		htmlBlock += "<li>" + words[i].sourceWord + "/" + words[i].destWord+ "</li>";
	}
	htmlBlock += "</ul>";
	
	document.getElementById('dictLookupCreole').innerHTML = htmlBlock;
	
	return false;
}

function searchDictionaryEnglish() {
	var searchWord = document.getElementById('searchWordEnglish').value;
	var words = Tradui.Database.Query.searchDictionary(searchWord, 'English', 'Creole');

	var htmlBlock = "<ul>";
	for ( var i=0, len=words.length; i<len; ++i ){
		htmlBlock += "<li>" + words[i].sourceWord + "/" + words[i].destWord+ "</li>";
	}
	htmlBlock += "</ul>";
	
	document.getElementById('dictLookupEnglish').innerHTML = htmlBlock;
	
	return false;
}

function performUpdate() {
	var html = "Data update from " + Tradui.Database.categoriesDataUrl + 
				" and " + Tradui.Database.phraseDataUrl + ".";
	document.getElementById('loadStatus').innerHTML = html;
	Tradui.Database.Management.updateDatabase();
	window.location.reload();
}

$(document).ready(function()
{
	Tradui.initialize();
	var status = Tradui.Database.Query.getTraduiStatus();
	var lastUpdated = new Date(status.lastUpdated);
	document.getElementById('loadStatus').innerHTML = "Last Updated: " + lastUpdated.toLocaleString();
	showLanguages();
});

</script>

<div style="margin: 25px; padding: 15px; border: 1px solid black;">
	<div id="languageList"></div>
	<div id="categoryList"></div>
	<div id="phraseList"></div>
	<div id="phraseDetails"></div>
</div>

<div style="margin: 25px; padding: 15px; border: 1px solid black;">
	<button onClick="return performUpdate();">Update Database</button> <div id="loadStatus"></div>
</div>

<div style="margin: 25px; padding: 15px; border: 1px solid black;">
	<form onsubmit="return searchDictionaryEnglish();">
		<input name="searchWordEnglish" id="searchWordEnglish" value=""/>
		<button >Lookup English Word</button>
	</form>

	<div id="dictLookupEnglish"></div>

	<form onsubmit="return searchDictionaryCreole();">
		<input name="searchWordCreole" id="searchWordCreole" value=""/>
		<button >Lookup Creole Word</button>
	</form>

	<div id="dictLookupCreole"></div>
</div>

</body>
</html>
